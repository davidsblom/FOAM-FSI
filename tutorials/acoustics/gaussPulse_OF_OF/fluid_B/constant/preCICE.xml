<?xml version="1.0"?>

<precice-configuration>

   <solver-interface dimensions="3" restart-mode="off" geometry-mode="off">

       <data:scalar name="Acoustics_Temperature"/>
       <data:scalar name="Acoustics_Velocity_X"/>
       <data:scalar name="Acoustics_Velocity_Y"/>
       <data:scalar name="Acoustics_Velocity_Z"/>
       <data:scalar name="Acoustics_Pressure"/>
       <data:scalar name="Acoustics_Temperature_Gradient"/>
       <data:scalar name="Acoustics_Velocity_X_Gradient"/>
       <data:scalar name="Acoustics_Velocity_Y_Gradient"/>
       <data:scalar name="Acoustics_Velocity_Z_Gradient"/>
       <data:scalar name="Acoustics_Pressure_Gradient"/>

       <mesh name="Fluid_Acoustics_A">
         <use-data name="Acoustics_Temperature"/>
         <use-data name="Acoustics_Velocity_X"/>
         <use-data name="Acoustics_Velocity_Y"/>
         <use-data name="Acoustics_Velocity_Z"/>
         <use-data name="Acoustics_Pressure"/>
         <use-data name="Acoustics_Temperature_Gradient"/>
         <use-data name="Acoustics_Velocity_X_Gradient"/>
         <use-data name="Acoustics_Velocity_Y_Gradient"/>
         <use-data name="Acoustics_Velocity_Z_Gradient"/>
         <use-data name="Acoustics_Pressure_Gradient"/>
       </mesh>

       <mesh name="Fluid_Acoustics_B">
         <use-data name="Acoustics_Temperature"/>
         <use-data name="Acoustics_Velocity_X"/>
         <use-data name="Acoustics_Velocity_Y"/>
         <use-data name="Acoustics_Velocity_Z"/>
         <use-data name="Acoustics_Pressure"/>
         <use-data name="Acoustics_Temperature_Gradient"/>
         <use-data name="Acoustics_Velocity_X_Gradient"/>
         <use-data name="Acoustics_Velocity_Y_Gradient"/>
         <use-data name="Acoustics_Velocity_Z_Gradient"/>
         <use-data name="Acoustics_Pressure_Gradient"/>
       </mesh>

       <participant name="Fluid_Solver_A">
         <use-mesh name="Fluid_Acoustics_A" provide="yes"/>
         <use-mesh name="Fluid_Acoustics_B" from="Fluid_Solver_B"/>

         <read-data mesh="Fluid_Acoustics_A" name="Acoustics_Temperature"/>
         <read-data mesh="Fluid_Acoustics_A" name="Acoustics_Velocity_X"/>
         <read-data mesh="Fluid_Acoustics_A" name="Acoustics_Velocity_Y"/>
         <read-data mesh="Fluid_Acoustics_A" name="Acoustics_Velocity_Z"/>
         <read-data mesh="Fluid_Acoustics_A" name="Acoustics_Pressure"/>

         <write-data mesh="Fluid_Acoustics_A" name="Acoustics_Temperature_Gradient"/>
         <write-data mesh="Fluid_Acoustics_A" name="Acoustics_Velocity_X_Gradient"/>
         <write-data mesh="Fluid_Acoustics_A" name="Acoustics_Velocity_Y_Gradient"/>
         <write-data mesh="Fluid_Acoustics_A" name="Acoustics_Velocity_Z_Gradient"/>
         <write-data mesh="Fluid_Acoustics_A" name="Acoustics_Pressure_Gradient"/>

         <mapping:nearest-neighbor direction="read" from="Fluid_Acoustics_B" to="Fluid_Acoustics_A" constraint="consistent" timing="initial"/>

         <export:vtk timestep-interval="1" directory="vtk" normals="0"/>

         <!-- <master:mpi-single /> -->
       </participant>

       <participant name="Fluid_Solver_B">
         <use-mesh name="Fluid_Acoustics_B" provide="yes"/>
         <use-mesh name="Fluid_Acoustics_A" from="Fluid_Solver_A"/>

         <read-data name="Acoustics_Temperature_Gradient" mesh="Fluid_Acoustics_B"/>
         <read-data name="Acoustics_Velocity_X_Gradient" mesh="Fluid_Acoustics_B"/>
         <read-data name="Acoustics_Velocity_Y_Gradient" mesh="Fluid_Acoustics_B"/>
         <read-data name="Acoustics_Velocity_Z_Gradient" mesh="Fluid_Acoustics_B"/>
         <read-data name="Acoustics_Pressure_Gradient" mesh="Fluid_Acoustics_B"/>

         <write-data name="Acoustics_Temperature" mesh="Fluid_Acoustics_B"/>
         <write-data name="Acoustics_Velocity_X" mesh="Fluid_Acoustics_B"/>
         <write-data name="Acoustics_Velocity_Y" mesh="Fluid_Acoustics_B"/>
         <write-data name="Acoustics_Velocity_Z" mesh="Fluid_Acoustics_B"/>
         <write-data name="Acoustics_Pressure" mesh="Fluid_Acoustics_B"/>

         <export:vtk timestep-interval="1" directory="vtk" normals="0"/>

         <mapping:nearest-neighbor direction="read" from="Fluid_Acoustics_A" to="Fluid_Acoustics_B" constraint="consistent" timing="initial"/>

         <!-- <master:mpi-single /> -->
       </participant>

      <m2n:sockets exchange-directory="../" from="Fluid_Solver_A" to="Fluid_Solver_B" distribution-type="gather-scatter"/>

      <coupling-scheme:serial-implicit>
        <participants first="Fluid_Solver_A" second="Fluid_Solver_B" />
        <max-timesteps value="500"/>
        <timestep-length value="1e-5"/>
        <exchange data="Acoustics_Temperature_Gradient" to="Fluid_Solver_B" from="Fluid_Solver_A" mesh="Fluid_Acoustics_A" initialize="no"/>
        <exchange data="Acoustics_Velocity_X_Gradient" to="Fluid_Solver_B" from="Fluid_Solver_A" mesh="Fluid_Acoustics_A" initialize="no"/>
        <exchange data="Acoustics_Velocity_Y_Gradient" to="Fluid_Solver_B" from="Fluid_Solver_A" mesh="Fluid_Acoustics_A" initialize="no"/>
        <exchange data="Acoustics_Velocity_Z_Gradient" to="Fluid_Solver_B" from="Fluid_Solver_A" mesh="Fluid_Acoustics_A" initialize="no"/>
        <exchange data="Acoustics_Pressure_Gradient" to="Fluid_Solver_B" from="Fluid_Solver_A" mesh="Fluid_Acoustics_A" initialize="no"/>

        <exchange data="Acoustics_Temperature" from="Fluid_Solver_B" to="Fluid_Solver_A" mesh="Fluid_Acoustics_B" initialize="yes"/>
        <exchange data="Acoustics_Velocity_X" from="Fluid_Solver_B" to="Fluid_Solver_A" mesh="Fluid_Acoustics_B" initialize="yes"/>
        <exchange data="Acoustics_Velocity_Y" from="Fluid_Solver_B" to="Fluid_Solver_A" mesh="Fluid_Acoustics_B" initialize="yes"/>
        <exchange data="Acoustics_Velocity_Z" from="Fluid_Solver_B" to="Fluid_Solver_A" mesh="Fluid_Acoustics_B" initialize="yes"/>
        <exchange data="Acoustics_Pressure" from="Fluid_Solver_B" to="Fluid_Solver_A" mesh="Fluid_Acoustics_B" initialize="yes"/>

        <relative-convergence-measure limit="1.0e-3" data="Acoustics_Temperature_Gradient" mesh="Fluid_Acoustics_A" suffices="0" />
        <relative-convergence-measure limit="1.0e-3" data="Acoustics_Velocity_X_Gradient" mesh="Fluid_Acoustics_A" suffices="0" />
        <relative-convergence-measure limit="1.0e-3" data="Acoustics_Velocity_Y_Gradient" mesh="Fluid_Acoustics_A" suffices="0" />
        <relative-convergence-measure limit="1.0e-3" data="Acoustics_Velocity_Z_Gradient" mesh="Fluid_Acoustics_A" suffices="0" />
        <relative-convergence-measure limit="1.0e-3" data="Acoustics_Pressure_Gradient" mesh="Fluid_Acoustics_A" suffices="0" />

        <relative-convergence-measure limit="1.0e-3" data="Acoustics_Temperature" mesh="Fluid_Acoustics_B" suffices="0" />
        <relative-convergence-measure limit="1.0e-3" data="Acoustics_Velocity_X" mesh="Fluid_Acoustics_B" suffices="0" />
        <relative-convergence-measure limit="1.0e-3" data="Acoustics_Pressure" mesh="Fluid_Acoustics_B" suffices="0" />

        <max-iterations value="10" />
    </coupling-scheme:serial-implicit>

   </solver-interface>

</precice-configuration>
